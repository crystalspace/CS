################################################################################
#
#           This is the root makefile for the Crystal Space engine
#
################################################################################

.PHONY: all help openbanner showconfig depend clean cleanlib cleandep \
  distclean maintainerclean libs plugins drivers drivers2d drivers3d \
  snddrivers netdrivers meshes softcanvas show

# The following two symbols are intended to be used in "echo" commands.
# config.mak can override them depending on configured platform's requirements.
"='
|=|

include config.mak
include $(TARGET_MAKEFILE)
include mk/user.mak
include mk/common.mak

# parameters for recursive make calls
RECMAKEFLAGS=--no-print-directory --no-builtin-rules
MAKEFLAGS+=r
@SET_MAKE@

# The initial driver and application targets help text
CONFIGHELP = \
  echo $"Configured for $(DESCRIPTION.$(TARGET)) with the following options:$"
DRIVERHELP = \
  echo $"The following Crystal Space drivers can be built:$"
PLUGINHELP = \
  echo $"The following Crystal Space plug-in modules can be built:$"
APPHELP = \
  echo $"The following Crystal Space applications can be built:$"
LIBHELP = \
  echo $"The following Crystal Space libraries can be built:$"
DOCHELP = \
  echo $"The following Crystal Space documentation targets can be invoked:$"
define PSEUDOHELP
  echo $"The following pseudo targets can be invoked:$"
  echo $"  make all          Make all important targets$"
  echo $"  make apps         Make all applications$"
  echo $"  make libs         Make all static libraries$"
  echo $"  make plugins      Make all plug-in modules including drivers$"
  echo $"  make meshes       Make all mesh plugins$"
  echo $"  make drivers      Make all drivers$"
  echo $"  make drivers2d    Make all supported 2D graphics drivers$"
  echo $"  make drivers3d    Make all supported 3D graphics renderers$"
  echo $"  make snddrivers   Make all supported sound drivers$"
  echo $"  make netdrivers   Make all supported network drivers$"
  echo $"  make check        Make and run tests (before commiting)$"
  echo $"  make depend       Make dependencies (recommended!)$"
  echo $"  make clean        Clean all files generated during build$"
  echo $"  make cleanlib     Clean all dynamic libraries$"
  echo $"  make cleandep     Clean all dependency rule files$"
  echo $"  make distclean    Clean everything$"
  echo $"  make platforms    List the available target platforms$"
endef

help: openbanner showconfig driverhelp pluginhelp libhelp apphelp dochelp \
  pseudohelp 

MAKESECTION=rootdefines
include mk/subs.mak

dep:
	@$(MAKE) $(RECMAKEFLAGS) -f mk/cs.mak $@ DO_DEPEND=yes

depend: cleandep dep

clean cleanlib cleandep distclean maintainerclean show:
	@$(MAKE) $(RECMAKEFLAGS) -f mk/cs.mak $@

unknown:
	$(RM) config.mak include/volatile.h

showconfig:
	@$(CONFIGHELP)
	@echo $"  USE_PLUGINS=$(USE_PLUGINS)$"
	@echo $"  MODE=$(MODE)$"
	@echo $"  EXTENSIVE_MEMDEBUG=$(EXTENSIVE_MEMDEBUG)$"
	@$(SYSMODIFIERS)
	@echo $(SEPARATOR)

driverhelp:
	@$(DRIVERHELP)
	@echo $(SEPARATOR)

pluginhelp:
	@$(PLUGINHELP)
	@echo $(SEPARATOR)

libhelp:
	@$(LIBHELP)
	@echo $(SEPARATOR)

apphelp:
	@$(APPHELP)
	@echo $(SEPARATOR)

dochelp:
	@$(DOCHELP)
	@echo $(SEPARATOR)

pseudohelp:
	@$(PSEUDOHELP)
	@echo $(SEPARATOR)

openbanner:
	@echo $(SEPARATOR)

MAKESECTION=roottargets
include mk/subs.mak
